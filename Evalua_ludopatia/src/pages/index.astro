---
import Layout from '../layouts/Layout.astro';
---

<Layout>
	<main class="min-h-screen flex items-center justify-center p-6">
		<div class="max-w-md w-full" x-data="{ currentRole: 'user' }">
			
			<div class="text-center mb-8">
				<h1 class="text-4xl font-extrabold text-purple-700 tracking-tight drop-shadow-sm">Evaluaci√≥n de Ludopat√≠a</h1>
				<p class="text-gray-600 mt-2 text-lg">Seleccione su rol para continuar</p>
			</div>

            <div id="error-msg" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-2xl relative mb-6 text-center shadow-sm text-sm font-bold hidden" role="alert">
                <span class="block sm:inline" id="error-text"></span>
            </div>

            <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100 transition-all duration-300">
                
                <!-- Selector (Toggle) -->
                <div class="flex bg-gray-100 rounded-2xl p-1 mb-8">
                    <button 
                        type="button"
                        @click="currentRole = 'user'" 
                        class="flex-1 py-3 text-sm font-bold rounded-xl transition-all flex items-center justify-center gap-2"
                        :class="currentRole === 'user' ? 'bg-white text-purple-600 shadow-md ring-1 ring-gray-200' : 'text-gray-500 hover:text-gray-700'">
                        üë§ Usuario
                    </button>
                    <button 
                        type="button"
                        @click="currentRole = 'admin'" 
                        class="flex-1 py-3 text-sm font-bold rounded-xl transition-all flex items-center justify-center gap-2"
                        :class="currentRole === 'admin' ? 'bg-white text-gray-800 shadow-md ring-1 ring-gray-200' : 'text-gray-500 hover:text-gray-700'">
                        ‚öôÔ∏è Administrador
                    </button>
                </div>

                <!-- Formulario -->
                <form action="/api/auth.php" method="POST" class="space-y-6"
                    x-ref="authForm"
                    @submit="$refs.typeField.value = currentRole">
                    
                    <input type="hidden" name="type" x-ref="typeField" value="user" />

                    <div x-show="currentRole === 'user'" x-cloak class="animate-fade-in text-center mb-6">
                        <div class="w-16 h-16 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mb-4 shadow-inner text-2xl mx-auto">üë§</div>
                        <h2 class="text-xl font-bold text-gray-800">Iniciar Encuesta</h2>
                        <p class="text-gray-500 text-sm mt-1">Ingrese sus datos para comenzar la evaluaci√≥n sobre ludopat√≠a.</p>
                    </div>

                    <div x-show="currentRole === 'admin'" x-cloak class="animate-fade-in text-center mb-6">
                        <div class="w-16 h-16 bg-gray-100 text-gray-800 rounded-full flex items-center justify-center mb-4 shadow-inner text-2xl mx-auto">‚öôÔ∏è</div>
                        <h2 class="text-xl font-bold text-gray-800">Panel Administrativo</h2>
                        <p class="text-gray-500 text-sm mt-1">Ingreso exclusivo para visualizar los resultados.</p>
                    </div>

                    <!-- Input de Usuario -->
                    <div x-show="currentRole === 'user'" x-cloak class="animate-fade-in">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Nombres y Apellidos</label>
                        <input type="text" name="nombre" placeholder="Ej. Juan P√©rez" class="w-full border-2 border-gray-200 rounded-2xl p-4 focus:ring focus:ring-purple-100 focus:border-purple-500 transition-all outline-none" />
                    </div>

                    <!-- Input de Administrador -->
                    <div x-show="currentRole === 'admin'" x-cloak class="animate-fade-in">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Contrase√±a de acceso</label>
                        <input type="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full border-2 border-gray-200 rounded-2xl p-4 focus:ring focus:ring-gray-100 focus:border-gray-500 transition-all outline-none" />
                        <p class="text-center text-gray-400 text-xs mt-3">Demo: admin123</p>
                    </div>

                    <!-- Bot√≥n din√°mico -->
                    <button type="submit" class="w-full text-white font-bold py-4 rounded-2xl shadow-lg transition-all"
                        :class="currentRole === 'user' ? 'bg-purple-600 hover:bg-purple-700' : 'bg-gray-800 hover:bg-black'">
                        <span x-text="currentRole === 'user' ? 'Comenzar Encuesta' : 'Acceder al Tablero'"></span>
                    </button>
                    
                </form>
            </div>

		</div>
	</main>
</Layout>

<script>
	import Alpine from 'alpinejs';
	if (!window.Alpine) {
        window.Alpine = Alpine;
	    Alpine.start();
    }

    // Mostrar errores desde URL params
    const params = new URLSearchParams(window.location.search);
    const errorMsg = params.get('error');
    if (errorMsg) {
        const el = document.getElementById('error-msg');
        const txt = document.getElementById('error-text');
        if (el && txt) { el.classList.remove('hidden'); txt.textContent = errorMsg === 'credenciales' ? 'Contrase√±a incorrecta' : 'Error al procesar solicitud'; }
    }
</script>

<style>
	[x-cloak] { display: none !important; }
    .animate-fade-in { animation: fadeIn 0.25s ease-out forwards; }
	@keyframes fadeIn { 
        from { opacity: 0; transform: translateY(-5px); } 
        to { opacity: 1; transform: translateY(0); } 
    }
</style>
